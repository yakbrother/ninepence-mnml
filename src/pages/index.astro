---
import { getCollection, render } from 'astro:content';
import '../styles/global.css';
import BaseLayout from '../layouts/BaseLayout.astro';
import StoryList from '../components/StoryList.astro';
const stories = await getCollection('stories');
const sortedStories = stories.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
const [newest, ...others] = sortedStories;
let Content = null;
if (newest) {
  const rendered = await render(newest);
  Content = rendered.Content;
}
---
<BaseLayout title="mostly true | virgil eaton">
  <article class="stack">

  {newest && (
    <>
      <h1>{newest.data.title.toLowerCase()}</h1>
      <hr/>
      <div class="post-date">{new Date(newest.data.date).toLocaleString('en-GB', { month: 'short', year: 'numeric', day: 'numeric' }).toLowerCase()} - virgil eaton</div>
      <div class="stack">
        {Content && <Content />}
      </div>
      {Array.isArray(newest.data.tags) && newest.data.tags.length > 0 && (
        <div class="tag-list" style="margin-top:2em;">
          {newest.data.tags.map(tag => (
            <a href={`/tags/${encodeURIComponent(tag)}/`} class="tag">{tag.toLowerCase()}</a>
          ))}
        </div>
      )}
    </>
  )}
  <h1>All Stories</h1>
  <StoryList stories={others} />
  </article>
</BaseLayout> 