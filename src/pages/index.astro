---
import { getCollection, render } from 'astro:content';
import '../styles/global.css';
import BaseLayout from '../layouts/BaseLayout.astro';
const stories = await getCollection('stories');
const sortedStories = stories.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());
const [newest, ...others] = sortedStories;
let Content = null;
if (newest) {
  const rendered = await render(newest);
  Content = rendered.Content;
}
---
<BaseLayout title="mostly true | virgil eaton">
  <article class="stack">

  {newest && (
    <>
      <h1 class="current-story">
        {newest.data.title.toLowerCase()}
      </h1>
      <hr/>
      <div class="post-date">{new Date(newest.data.date).toLocaleString('en-GB', { month: 'short', year: 'numeric', day: 'numeric' }).toLowerCase()} - virgil eaton - <a href={`/stories/${newest.id}/`} class="permalink" title="permalink">
          permalink
                  </a></div>
      <div class="stack">
        {Content && <Content />}
      </div>

      {Array.isArray(newest.data.tags) && newest.data.tags.length > 0 && (
      <nav class="tag-list" aria-labelledby="tags-heading" style="margin-top:2em;">
        <h2 id="tags-heading" class="visually-hidden">Story tags</h2>
        <ul class="tag-list-items">
          {newest.data.tags.map((tag: string) => (
            <li><a href={`/tags/${encodeURIComponent(tag)}/`} class="tag">{tag.toLowerCase()}</a></li>
          ))}
        </ul>
      </nav>
    )}
    </>
  )}
  </article>
</BaseLayout> 