---
import { getCollection, getEntry, render, type CollectionEntry } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

export async function getStaticPaths() {
  const stories = await getCollection('stories');
  return stories.map(story => ({
    params: { slug: story.id }
  }));
}

const { slug } = Astro.params;
const story = await getEntry('stories', slug) as CollectionEntry<'stories'>;
if (!story) throw new Error('Story not found');
const { Content } = await render(story);
---
<BaseLayout title={`${story.data.title} | mostly true`}>
  <article>
    <h1>{story.data.title}</h1>
    <div class="post-date">{new Date(story.data.date).toLocaleString('en-US', { month: 'short', year: 'numeric', day: 'numeric' })}</div>
    <div class="post-summary">{story.data.description}</div>
    <div class="post-content">
      <Content />
    </div>
  </article>
</BaseLayout> 