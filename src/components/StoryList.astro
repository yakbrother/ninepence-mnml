---
import { sanityClient } from 'sanity:client';

export interface Props {
  stories?: any[];
  currentStory?: string;
}

const { stories, currentStory } = Astro.props;

// If no stories are passed, fetch all stories and sort them by date
let displayStories = stories || [];
if (!stories || stories.length === 0) {
  const allStories = await sanityClient.fetch(`*[_type == "story" && !draft] | order(date desc)`);
  displayStories = allStories;
}
---

<aside>
{displayStories.map(story => (
  <article class={`post ${story.slug.current === currentStory ? 'current-story-card' : ''}`}>
    <header>
      <time class="post-date" datetime={new Date(story.date).toISOString()}>{new Date(story.date).toLocaleString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' }).toLowerCase()}</time>
      <h3 class="post-title">
        <a href={`/stories/${story.slug.current}/`}>{story.title.toLowerCase()}</a>
      </h3>
    </header>
    <div class="post-summary">{story.description}</div>
  </article>
))} 
</aside>

<style>

a {
  text-decoration-style: underline dotted;
  text-decoration-color: var(--color-dark);
  color: var(--color-dark);
}

a:hover {
  text-decoration: underline dotted;
  text-decoration-color: var(--color-link-hover);
  color: var(--color-link-hover);
}

</style>